# Pre-commit hooks configuration for Spark development
# Install with: pre-commit install
# Run manually with: pre-commit run --all-files

repos:
  # Python code formatting
  - repo: https://github.com/psf/black
    rev: 23.9.1
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=100]

  # Import sorting
  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: [--profile=black, --line-length=100]

  # Python linting
  - repo: https://github.com/pycqa/flake8
    rev: 6.1.0
    hooks:
      - id: flake8
        args: [--max-line-length=100, --extend-ignore=E203,W503]
        additional_dependencies:
          - flake8-docstrings
          - flake8-import-order
          - flake8-bugbear

  # Type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.5.1
    hooks:
      - id: mypy
        additional_dependencies: [types-PyYAML, types-requests]
        args: [--ignore-missing-imports]

  # Security scanning
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: [-r, --format=custom, --configfile=.bandit]
        exclude: ^tests/

  # Dependency scanning
  - repo: https://github.com/pyupio/safety
    rev: 2.3.4
    hooks:
      - id: safety
        args: [--json]

  # YAML formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.0.3
    hooks:
      - id: prettier
        types: [yaml]

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-toml
      - id: check-merge-conflict
      - id: check-added-large-files
        args: [--maxkb=10000]
      - id: check-case-conflict
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

  # Dockerfile linting
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.1-beta
    hooks:
      - id: hadolint-docker
        args: [--ignore, DL3008, --ignore, DL3009]

  # SQL formatting (if using SQL files)
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 2.3.2
    hooks:
      - id: sqlfluff-lint
        additional_dependencies: [sqlfluff-templater-dbt]
      - id: sqlfluff-fix
        additional_dependencies: [sqlfluff-templater-dbt]

  # Custom Spark-specific hooks
  - repo: local
    hooks:
      # Spark schema validation
      - id: validate-spark-schemas
        name: Validate Spark Schemas
        entry: python scripts/validate_schemas.py
        language: system
        files: ^.*schemas.*\.py$
        pass_filenames: true

      # PySpark code quality
      - id: pyspark-lint
        name: PySpark Specific Linting
        entry: python scripts/pyspark_lint.py
        language: system
        files: \.py$
        exclude: ^tests/

      # Configuration validation
      - id: validate-configs
        name: Validate Configuration Files
        entry: python scripts/validate_configs.py
        language: system
        files: ^config/.*\.(yaml|yml|json)$

      # Test coverage check
      - id: test-coverage
        name: Check Test Coverage
        entry: python scripts/check_coverage.py
        language: system
        pass_filenames: false
        always_run: true

      # Documentation check
      - id: check-docstrings
        name: Check Python Docstrings
        entry: python scripts/check_docstrings.py
        language: system
        files: \.py$
        exclude: ^tests/

# Global exclusions
exclude: |
  (?x)^(
    \.git/|
    \.venv/|
    venv/|
    __pycache__/|
    \.pytest_cache/|
    \.mypy_cache/|
    build/|
    dist/|
    \.tox/|
    spark-warehouse/|
    metastore_db/|
    derby\.log
  )

# Minimum pre-commit version
minimum_pre_commit_version: 3.0.0

# CI configuration
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false